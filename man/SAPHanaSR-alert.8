.\" Version: 1.001
.\"
.TH SAPHanaSR-alert 7 "12 Jun 2024" "" "SAPHanaSR"
.\" TODO SAPHanaSR-alert-fencing ?
.\"
.SH NAME
SAPHanaSR-alert \- Alert agent for cluster fencing alerts.
.PP
.\"
.SH DESCRIPTION
SAPHanaSR-alert can be used to react on Linux cluster fencing alerts.
.PP
The Linux cluster provides an interface to take external action when a cluster
event occurs (alert). Than the cluster calls an external program (an alert agent)
to handle that alert.
.PP
When the Linux cluster has performed a node fencing, it can call SAPHanaSR-agent
on each active cluster node. The agent checks whether the local node belongs to
the same HANA site as the fenced node. If so, it asks the cluster to fence the
local node as well.
.PP
SAPHanaSR-agent is used to fence all nodes of an HANA site, in case one of
them gets fenced. This improves three use cases for HANA scale-out:
.br
- HA/DR provider hook script susChkSrv.py action_on_lost=fence
.br
- resource agent SAPHanaController ON_FAIL_ACTION=fence
.br
- resource agent SAPHanaFilesystem ON_FAIL_ACTION=fence
.br
See also manual pages ocf_sus_SAPHanaController(7), ocf_suse_SAPHanaFilesystem(7)
and susChkSrv.py(7).
.PP
.\"
.SH SUPPORTED PARAMETERS
.TP
\fBtimeout\fR
If the alert agent does not complete within this amount of time, it will be terminated. Optional, default "30s". Example "meta timeout=30s".
.TP
\fBenabled\fR
If false for an alert, the alert will not be used. If true for an alert and false for a particular recipient of that alert, that recipient will not be used. Optional, default "true".
.\"
.PP
.\"
.SH RETURN CODES
.B 0
Successful program execution.
.br
.B >0
Usage, syntax or execution errors.
.br
In addition log entries are written, which can be scanned by using a pattern
like "SAPHanaSR-alert".
.PP
.\"
.SH EXAMPLES
.PP
\fB*\fR Example configuration for the fencing alert handler.
.PP
The following line needs to be added to the clusterÂ´s CIB:
.PP
.RS 2
alert fencing-1 "/usr/bin/SAPHanaSR-alert" select fencing
.RE
.PP
\fB*\fR Example for configuring the alert agent by using crm.
.PP
Alternate way for configuring the alert agent.
.PP
.RS 2
# crm configure alert fencing-1 "/usr/bin/SAPHanaSR-alert" select fencing
.RE
.PP
\fB*\fR Showing all configured alert agents.
.PP
.RS 2
# crm configure show | grep -A1 alert
.RE
.PP
\fB*\fR Showing agent messages.
.PP
.RS 2
# grep SAPHanaSR-alert /var/log/messages
.RE
.PP
\fB*\fR Showing history of fence actions.
.PP
.RS 2
# crm_mon -1 --include=none,fencing
.RE
.PP
\fB*\fR Example for manually fencing an node.
.PP
This  could be done for testing the SAPHanaSR-alert agent integration.
This test should not be done on production systems.
See manual page crm(8) for details.
Fenced node is node1.
.br
Note: Understand the impact before trying.
.PP
.RS 2
# crm node fence node1
.RE
.PP
.\"
.SH FILES
.TP
/usr/bin/SAPHanaSR-alert
the alert agent
.TP
/run/crm/SAPHanaSR_site_cache
the internal cache for host to site relation - do not touch this file
.PP
.\"
.SH REQUIREMENTS
1. Pacemaker 2.1.6 or newer.
.PP
2. SAP HANA scale-out performance-optimized scenario.
.PP
3. Only one SID is controlled by the Linux cluster.
.PP
4. Site names and host names should not be changed.
.PP
5. No other alert agent should be configured for the fencing alert.
.PP
6. Automatic re-start on just fenced nodes should be disabled. See manual page
sbd(8) for details.
.PP
7. The alert agent runtime almost completely depends on call-outs to OS and
Linux cluster.
.\"
.SH BUGS
In case of any problem, please use your favourite SAP support process to open
a request for the component BC-OP-LNX-SUSE.
Please report any other feedback and suggestions to feedback@suse.com.
.PP
.\"
.SH SEE ALSO
\fBSAPHanaSR-angi\fP(7) , \fBSAPHanaSR-ScaleOut\fP(7) ,
\fBocf_suse_SAPHanaController\fP(7) , \fBocf_suse_SAPHanaFilesystem\fP(7) ,
\fBsusChkSrv.py\fP (7) , \fBcrm\fP(8) ,
.br
https://clusterlabs.org/pacemaker/doc/2.1/Pacemaker_Administration/singlehtml/#alert-agents
.PP
.\"
.SH AUTHORS
F.Herschel, L.Pinne.
.PP
.\"
.SH COPYRIGHT
.br
(c) 2024 SUSE LLC
.br
SAPHanaSR-alert comes with ABSOLUTELY NO WARRANTY.
.br
For details see the GNU General Public License at
http://www.gnu.org/licenses/gpl.html
.\"
