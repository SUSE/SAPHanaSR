.\" Version: 1.2 
.\"
.TH SAPHanaSR-ScaleOut-XSA 7 "26 Nov 2025" "" "SAPHanaSR-angi"
.\"
.SH NAME
.\"
SAPHanaSR-ScaleOut-XSA \- Automating SAP HANA system replication for standalone XSA setups.
.PP
.\"
.SH DESCRIPTION
.\"
This manual page provides information for setting up and managing automation of
SAP HANA system replication (SR) in scale-out setups with a standalone eXtended
application Services Advanced (XSA) server.
For other scale-out scenarios, please refer to SAPHanaSR-ScaleOut(7).
.PP
SAP HANA XSA provides a platform for the development and execution of micro-service
oriented applications.
.PP
The scale-out standalone XSA scenario consists of two nodes per site.
One node runs the HANA master namesever and an indexserver. The other node runs
an HANA nameserver slave and the standalone XSA server, but no indexserver.
.\" TODO roles  slave:slave:none:none
HANA system replication is set up between the two sites. In addition, the XSA
Filesystem Storage (fss) is shared across the sites.
.PP
The cluster resource configuration for HANA scale-out with standalone XSA is
almost the same as for the scale-out ERP scenario, progressive variant.
.br
The differences are curently:
.br
- no 3rd replication site connected
.br
+ additional IPaddr2 resource for the primary XSA worker
.br
+ additional SAPHanaFilesystem resource for the XSA fss directory (optional)
.PP
For details, please refer to SAPHanaController-scale-out(7),
ocf_suse_SAPHanaTopology(7), ocf_suse_SAPHanaFilesystem(7),
susHanaSR.py(7), susChkSrv.py(7), susTkOver.py(7), 
SAPHanaSR-alert-fencing(8), SAPHanaSR-hookHelper(8), 
SAPHanaSR-ScaleOut_basic_cluster(7), and see IPaddr2 example below.
.PP
\fBThe SUSE HA for SAP HANA SR scale-out standalone XSA scenario is a technology preview.\fP
.PP
.\"
.SH EXAMPLES
.\"
\fB*\fP Overview on setting up SAP HANA with standalone XSA and system replication.
.PP
The site2 will become primary in this example, site1 will become secondary.
.PP
collect needed information and prepare parameter sheet
.PP
install HANA with standalone XSA on site1 with node11 (master/worker) and node12 (xs_worker)
.br
install HANA with standalone XSA on site2 with node21 (master/worker) and node22 (xs_worker)
.br
export share with fss directory on NFS server
.br
prepare /etc/fstab on node12 and node22
.br
copy XSA ssfs keystore from site2 to site1
.PP
disable XSA, back-up XSA fss on node12
.br
change fss to NFS in xscontroller.ini on site1
.br
create mountpoint for fss share on node12
.br
mount fss share from NFS on node12
.br
restore XSA fss, enable XSA on node12
.br
stop HANA on site1
.PP
disable XSA, back-up XSA fss on node22
.br
change fss to NFS in xscontroller.ini on site2
.br
mount fss share from NFS on node22
.br
restore XSA fss, enable XSA on node22
.br
copy xscontroller.ini from site2 to site1
.PP
back-up HANA on node21
.br
enable HANA system replication on node11
.PP
register HANA site1 as secondary to node21
.br
start HANA on site1
.br
check everything is fine at site1 and site2
.PP
do manual takeover at site1
.br
register HANA site2 as secondary to node11
.br
check everything is fine at site1 and site2
.PP
\fB*\fP XSA fss entry in xscontroller.ini.
.PP
Example SID is HA1, directory is xsfss.
.PP
.RS 2
# cat /hana/shared/HA1/global/hdb/custom/config/xscontroller.ini
.br
 ...
.br
[fss]
.br
fss_storage_path = /hana/shared/HA1/xs/controller_data/xsfss 
.RE
.PP
\fB*\fP XSA fss entry in /etc/fstab.
.PP
Below is an fstab example for a shared filesystem holding the XSA fss. 
This filesystem is needed on both XSA standalone nodes, not on the HANA
master nodes.
.br
The correct mount options are depending on the NFS server. However, client-side
write caching has to be disabled. The path has to match fss_storage_path in
xscontroller.ini. Since the fss directory is mounted below /hana/shared, which
also comes from outside, the fss entry should follow later.
.PP
.RS 2
nfs1:/s/ha1/xsfss /hana/shared/HA1/xs/controller_data/xsfss nfs4 rw,noac,sync,default 0 0
.RE
.PP
Note: The NFS share might be monitored, but not mounted/umounted by the HA cluster.
See ocf_suse_SAPHanaFilesystem(7) for details.
.RE
.PP
\fB*\fP Creating local mountpoint for XSA fss from remote NFS.
.PP
Needs to be done at both sites before mounting the shared XSA fss.
As above, SID is HA1 and directory is xsfss.
.PP
.RS 2
# mkdir /hana/shared/HA1/xs/controller_data/xsfss
.br
# chown ha1adm:sapsys /hana/shared/HA1/xs/controller_data/xsfss
.RE
.PP
\fB*\fP Copying the XSA ssfs keystore from primary site to secondary.
.PP
Needs to be done before registering the secondary site.
Primary site is site2, secondary site is site1, SID is HA1.
.PP
.RS 2
# cd hana/shared/HA1/global/xsa/security/
.br
# md5sum ssfs/*/*
.br
# rsync -va ssfs node11:$PWD/ 
.br
# ssh node11 "md5sum $PWD/ssfs/*/*"
.RE
.PP
\fB*\fP Disabling XSA and backing up the fss.
.PP
Needs to be done at both sites before changing the fss from local to NFS.
SID is HA1.
.PP
.RS 2
# su - ha1adm -c "XSA disable; XSA backup-fss"
.RE
.PP
\fB*\fP Restoring the fss and enabling XSA.
.PP
Needs to be done at both sites after the fss has been changed from local to NFS.
SID is HA1.
.br
Make sure not both active XSA sites will access the shared fss directory at the
same time.
.PP
.RS 2
# su - ha1adm -c "XSA restore-fss; XSA enable"
.RE
.PP
\fB*\fP Stopping HANA, including XSA.
.PP
Needs to be done at the site that should become secondary, before the fss at the
other site is changed from local to NFS.
SID is HA1, instance number is 00.
.PP
.RS 2
# su - ha1adm
.br
~> sapcontrol -nr 00 -function StopSystem
.br
.\" TODO 30 60?
~> sapcontrol -nr 00 -function WaitforStopped 30 60
.br
~> sapcontrol -nr 00 -function GetSystemInstanceList
.RE
.PP
\fB*\fP Copying xscontroller.ini from primary to secondary site.
.PP
.\" TODO Needs to be done before 
SID is HA1, secondary site XSA node is node11.
.br
Make sure XSA at secondary site is stopped before copying.
.PP
.RS 2
# scp /hana/shared/HA1/global/hdb/custom/config/xscontroller.ini node11:/hana/shared/HA1/global/hdb/custom/config/
.RE
.PP
\fB*\fP Backing up HANA and enabling system replication as primary site.
.PP
Needs to be done at future primary site, before registering the other site as
secondary.
SID is HA1, primary site is site2, instance number is 00.
.PP
.RS 2
# su - ha1adm
.br
~> hdbsql -i 00 -u SYSTEM -d SYSTEMDB \\
.br
 "BACKUP DATA FOR FULL SYSTEM USING FILE ('backup')"
.br
~> hdbnsutil -sr_enable --name=site2 
.RE
.PP
\fB*\fP Registering and starting HANA as secondary site.
.PP
SID is HA1, secondary site is site1, primary master is node21, instance number
is 00.
Needs primary site up and running.
.PP
.RS 2
# su - ha1adm
.br
~> hdbnsutil -sr_register --name=site1 \\
.br
 --remoteHost=node21 --remoteInstance=00 \\
.br
 --replicationMode=sync --operationMode=logreplay
.br
~> sapcontrol -nr 00 -function StartSystem
.RE
.PP
\fB*\fP Checking HANA database and XSA are fine.
.PP
Should be done at both sites, before anything will be done and after having done
anything on HANA database and XSA.
SID is HA1, instance number is 00.
.PP
.RS 2
# su - ha1adm
.br
~> hdbnsutil -sr_state
.br
~> sapcontrol -nr 00 -function GetSystemInstanceList
.br
~> cdpy; python landcscapeHostConfiguration.py
.br
~> cdpy; python systemReplicationStatus.py
.br
~> XSA info
.RE
.PP
Note: Older HANA versions do not support systemReplicationStatus.py at secondary
site.
.PP
\fB*\fP Overview on manual takeover for HANA database and XSA.
.PP
A manual takeover should be done for testing HANA database and XSA setup, before
integrating with the Linux cluster.
.br
Once HANA database and XSA are controlled by the Linux cluster, the cluster
resource has to be set into maintenance before doing a manual takeover. See
SAPHanaSR_maintenance_examples(7).
.PP
The manual takeover can be done by following this procedure:
.br
.RS 2
1. On both sites: Check everything is fine.
Make sure HANA database and XSA are not controlled by the Linux cluster.
.br
2. On primary site: Stop HANA database and XSA
(sapcontrol ... StopSystem).
.br
3. On secondary site: Do takeover
(hdbnsutil -sr_takeover).
.br
4. On new primaary site: Check everything is fine.
.br
5. On former primary site: Register as new secondary and start
(hdbnsutil -sr_register ... ; sapcontrol ... StartSystem).
.br
6. On both sites: Check everything is fine.
.RE 
.PP
\fB*\fP IPaddr2 resource for primary XSA.
.PP
Needs to run together with the primary XSA services. Is used by xscontroller
for connecting internally, and is used by external clients. Thus this IP address
needs to be resolved as wildcard DNS entry. 
.br
The shown location constraint works for setups with two nodes per site.
Example SID is HA1, instance number is 00, IP address is 192.168.178.188.
.PP
.RS 2
primitive rsc_ip_HA1_XSA00 IPaddr2 \\
.br
 op monitor interval=10s timeout=20s \\
.br
 params ip=192.168.178.188
.PP
location loc_ip_HA1_XSA00 \\
.br
 rsc_ip_HA1_XSA00 \\
.br
 rule 2000: master-rsc_SAPHanaCon_HA1_HDB00 eq 101
.PP
See also ocf_hearbeat_IPAddr(2) and SAPHanaSR-ScaleOut_basic_cluster(7).
.RE
.PP
\fB*\fP SAPHanaFilesystem resource for the shared XSA fss.
.PP
Optional resource to check the NFS sharing XSA fss across sites.
.\" The HANA consists of two sites with two nodes each. An additional cluster node
.\" is used as majority maker for split brain situations. One /hana/shared/... filesystem
.\" is used per site. This filesystem is provided by an NFS server and shared across
.\" sites. On both XSA worker nodes the NFS share is mounted statically. 
See also ocf_suse_SAPHanaFilesystem(7).
SID is HA1, instance number is 00, shared directory is
/hana/shared/HA1/xs/controller_data/xsfss as defined in
/etc/fstab, cluster nodes without fss are nodemm, node11 and node21.
.PP
.RS 2
primitive rsc_SAPHanaFil_HA1_XSA00 ocf:suse:SAPHanaFilesystem \\
.br
  op start interval="0" timeout="10" \\
.br
  op stop interval="0" timeout="20" on-fail="fence" \\
.br
  op monitor interval="120" timeout="180" \\
.br
  params SID="HA1" InstanceNumber="00"\\
.br
  DIRECTORY="/hana/shared/HA1/xs/controller_data/xsfss"
.PP
clone cln_SAPHanaFil_HA1_XSA00 rsc_SAPHanaFil_HA1_XSA00 \\
.br
  meta clone-node-max="1" interleave="true"
.PP
location SAPHanaFil_XSA_not_nodemm cln_SAPHanaFil_HA1_XSA00 -inf: nodemm
.br
location SAPHanaFil_XSA_not_node11 cln_SAPHanaFil_HA1_XSA00 -inf: node11
.br
location SAPHanaFil_XSA_not_node21 cln_SAPHanaFil_HA1_XSA00 -inf: node21
.RE
.PP
.\"
.SH FILES
.\"
.TP
/hana/shared/<SID>/global/hdb/custom/config/xscontroller.ini
XSA controller configuration.
.TP
/hana/shared/<SID>/xs/controller_data/fss/
default Filesystem Storage directory.
.TP
/etc/passwd , /etc/groups
local users and groups definition files.
.TP
/etc/fstab
static information about the filesystems.
.PP
.\"
.SH REQUIREMENTS
.\"
\fB*\fP Currently two nodes per site are supported. One HANA master/worker and
one standalone XSA worker.
.PP
\fB*\fP The SAP HANA XSA service is installed for hostname based routing. This needs
DNS wildcard support at DNS server side.
.PP
\fB*\fP Both sites are using the same XSA default domain and api url. 
.PP
\fB*\fP The XSA service IP address is configured as cluster resource and is moved
together with the primary XSA.
.PP
\fB*\fP A highly available NFS service provides the shared XSA Filesystem Storage
(fss) directory across sites. The fss is configured identically on both sites.
.PP
\fB*\fP Linux user <sid>adm has same UID and GIDs on all cluster nodes.
.PP
\fB*\fP Linux user <sid>adm has sudo permission ALL for Linux users <sid>xsa and
sap<sid>xsa.
.PP
\fB*\fP The XSA secure keystore (ssfs) is copied from primary to secondary site.
.PP
\fB*\fP SAP HANA host auto-failover is not supported.
.PP
\fB*\fP Multi-target or multi-tier system replication is not supported.
.PP
\fB*\fP SAPHanaController relies on HANA landscape status. Takeover will not be
 initiated for landscape status 2, 3 and 4. See SAPHanaController-scale-out(7).
.PP
\fB*\fP The XSA scenario should be configured as progressive variant. See
SAPHanaSR-angi-scenarios(7).
.PP
\fB*\fP For requirements of the overall scale-out setup, see also the REQUIREMENTS
section in SAPHanaSR-ScaleOut(7).
.PP
\fB*\fP For requirements of SAP HANA XSA, please refer to the SAP product documentation.
.PP
\"
.SH BUGS
.\"
In case of any problem, please use your favourite SAP support process to open
a request for the component BC-OP-LNX-SUSE.
Please report any other feedback and suggestions to feedback@suse.com.
.PP
.\"
.SH SEE ALSO
.\"
\fBSAPHanaSR-angi\fP(7) , \fBSAPHanaSR-ScaleOut\fP(7) ,
\fBSAPHanaSR-angi-scenarios\fP(7) , \fBSAPHanaController-scale-out\fP(7) ,
\fBocf_suse_SAPHanaFilesystem\fP(7) , \fBsusChkSrv.py\fP(7) ,
\fBSAPHanaSR-alert-fencing\fP(7) , \fBSAPHanaSR_maintenance_examples\fP(7) ,
\fBfstab\fP(5) , \fBnfs\fP(5) ,
.br
https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/5bc11f2ca7744bfd9d23d09e5b616433.html?version=2.0.07 ,
.br
https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/99306be18a1f493b990cf9d8d90cd922.html?version=2.0.07 ,
.br
1999880 - FAQ: SAP HANA System Replication
.br
2183363 - Configuration of SAP HANA internal network
.br
2243019 - Providing SSL certificates for domains defined in SAP HANA extended application services, advanced model
.br
2243156 - Secure user setup for SAP HANA extended application services, advanced model
.br
2245631 - Domains and routing configuration for SAP HANA extended application services, advanced model
.br
2303772 - SAP HANA XS Advanced Model SPS12 Release Note
.br
2300936 - Failover & High Availability with SAP HANA extended application services, advanced model
.br
2300937 - Backup and restore for SAP HANA extended application services, advanced model then notice XSA can't start up with error:
.br
2300943 - Enabling JDBC SSL encryption for SAP HANA extended application services, advanced model
.br
2507070 - 
.br
2509043 -
.br
2511224 - How to activate a XSA technical user
.br
2564474 - Installation of SAP HANA XS Advanced Runtime fails with error "Assigning Additional Roles to the Local Host failed".
.br
2596466 - FAQ: SAP HANA XS Advanced Information published on SAP
.br
2741459 - VA32 dump: DBSQL_DUPLICATE_KEY_ERROR
.br
2749450 - XSA technical user is frequently locked - authentication failed
.br
2752384 - HANA XS Advanced does not start - Unable to read the SID from the SL config store - authentication failed
.br
2866031 - 
.br
3014176 -
.br
3114270 - How to change the port used by existing application on XSA(XS advanced)
.br
3224631 - Hana is unavailable with message: "process is terminating, because lockfile '/usr/sap/.../../../lock/hdbindexserver@....pid' is missing/wrong."
.br
3234663 - XSA can't start up after system refresh due to error "Unable to locate XSA persistence within tenant db '<DB name>'"
.br
3335637 - Installation of SAP HANA XS Advanced Runtime stucks in adding the role xs_worker
.br
3449644 - Not able to change the XSA default_domain with xscontroller.ini
.PP
.\"
.SH AUTHORS
.\"
A.Briel, F.Herschel, L.Pinne.
.PP
.\"
.SH COPYRIGHT
.\"
(c) 2025 SUSE LLC
.br
The package SAPHanaSR-angi comes with ABSOLUTELY NO WARRANTY.
.br
For details see the GNU General Public License at
http://www.gnu.org/licenses/gpl.html
.\"
